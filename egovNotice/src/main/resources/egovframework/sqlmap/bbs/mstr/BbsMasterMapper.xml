<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BbsMasterDAO">

	<!-- 목록 카운트 -->
	<select id="selectBbsMasterListCnt"
		parameterType="egovframework.let.bbs.mstr.vo.BbsMasterVO"
		resultType="int">
		
		SELECT COUNT(1)
		FROM COMTCBBSMASTER A
		WHERE 1=1
		<if test="useAt != null and useAt != ''">
			AND A.USE_AT = #{useAt}
		</if>

		<if test="searchKeyword != null and searchKeyword != ''">
			<choose>
				<when test="searchCondition == '1'">
					AND A.BBS_ID LIKE '%' || #{searchKeyword} || '%'
				</when>
				<otherwise>
					AND A.BBS_NM LIKE '%' || #{searchKeyword} || '%'
				</otherwise>
			</choose>
		</if>
	</select>


	<!-- 목록 조회 (Oracle 페이징: ROW_NUMBER 방식) -->
	<select id="selectBbsMasterList"
		parameterType="egovframework.let.bbs.mstr.vo.BbsMasterVO"
		resultType="egovframework.let.bbs.mstr.vo.BbsMasterVO">
		
		SELECT
			bbsId,
			bbsNm,
			bbsIntrcn,
			bbsTyCode,
			fileAtchPosblAt,
			atchPosblFileNumber,
			atchPosblFileSize,
			useAtCol,
			frstRegisterId,
			frstRegistPnttm,
			lastUpdusrId,
			lastUpdtPnttm
		FROM (
			SELECT
				ROW_NUMBER() OVER (ORDER BY A.FRST_REGIST_PNTTM DESC) AS rn,

				A.BBS_ID AS bbsId,
				A.BBS_NM AS bbsNm,
				A.BBS_INTRCN AS bbsIntrcn,
				A.BBS_TY_CODE AS bbsTyCode,
		
				A.FILE_ATCH_POSBL_AT AS fileAtchPosblAt,
				A.ATCH_POSBL_FILE_NUMBER AS atchPosblFileNumber,
				A.ATCH_POSBL_FILE_SIZE AS atchPosblFileSize,
		
				A.USE_AT AS useAtCol,
		
				A.FRST_REGISTER_ID AS frstRegisterId,
				A.FRST_REGIST_PNTTM AS frstRegistPnttm,
				A.LAST_UPDUSR_ID AS lastUpdusrId,
				A.LAST_UPDT_PNTTM AS lastUpdtPnttm
			FROM COMTCBBSMASTER A
			WHERE 1=1
			<if test="useAt != null and useAt != ''">
				AND A.USE_AT = #{useAt}
			</if>
	
			<if test="searchKeyword != null and searchKeyword != ''">
				<choose>
					<when test="searchCondition == '1'">
						AND A.BBS_ID LIKE '%' || #{searchKeyword} || '%'
					</when>
					<otherwise>
						AND A.BBS_NM LIKE '%' || #{searchKeyword} || '%'
					</otherwise>
				</choose>
			</if>
			)
		WHERE rn &gt; #{firstIndex}
		AND rn &lt;= #{lastIndex}
		ORDER BY rn
	</select>
	
	<insert id="insertBbsMaster" parameterType="egovframework.let.bbs.mstr.vo.BbsMasterVO">
	  INSERT INTO COMTCBBSMASTER (
	  	BBS_ID,
	    BBS_NM,
	    BBS_INTRCN,
	    BBS_TY_CODE,
	    FILE_ATCH_POSBL_AT,
	    ATCH_POSBL_FILE_NUMBER,
	    ATCH_POSBL_FILE_SIZE,
	    USE_AT,
	    FRST_REGISTER_ID,
	    FRST_REGIST_PNTTM,
	    LAST_UPDUSR_ID,
	    LAST_UPDT_PNTTM
	  ) VALUES (
	    #{bbsId},
	    #{bbsNm},
	    #{bbsIntrcn},
	    #{bbsTyCode},
	    #{fileAtchPosblAt},
	    #{atchPosblFileNumber},
	    #{atchPosblFileSize},
	    #{useAt},
	    #{frstRegisterId},
	    SYSDATE,
	    #{lastUpdusrId},
	    SYSDATE
	  )
	</insert>

	<!-- 상세 -->
	<select id="selectBbsMasterDetail"
	        parameterType="egovframework.let.bbs.mstr.vo.BbsMasterVO"
	        resultType="egovframework.let.bbs.mstr.vo.BbsMasterVO">
	  SELECT
	    BBS_ID                 AS bbsId,
	    BBS_NM                 AS bbsNm,
	    BBS_INTRCN             AS bbsIntrcn,
	    BBS_TY_CODE            AS bbsTyCode,
	    FILE_ATCH_POSBL_AT     AS fileAtchPosblAt,
	    ATCH_POSBL_FILE_NUMBER AS atchPosblFileNumber,
	    ATCH_POSBL_FILE_SIZE   AS atchPosblFileSize,
	    USE_AT                 AS useAt,
	    FRST_REGISTER_ID       AS frstRegisterId,
	    FRST_REGIST_PNTTM      AS frstRegistPnttm,
	    LAST_UPDUSR_ID         AS lastUpdusrId,
	    LAST_UPDT_PNTTM        AS lastUpdtPnttm
	  FROM COMTCBBSMASTER
	  WHERE BBS_ID = #{bbsId}
	</select>

</mapper>
